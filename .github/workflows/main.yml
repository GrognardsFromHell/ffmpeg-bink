name: ffmpeg

on: 
  push:
    paths: 
      - .github/workflows/ffmpeg.yml
      - build.sh

jobs:
  build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v1
    - name: Install MSYS2
      run: choco install msys2 --no-progress
    - name: Checkout FFmpeg
      run: git clone https://github.com/FFmpeg/FFmpeg
    - name: Build FFmpeg
      run: |
        call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\Common7\Tools\VsDevCmd.bat" -arch=amd64 -host_arch=amd64
        C:\tools\msys64\usr\bin\bash -lc "./build.sh -b"
      shell: cmd
      env:
        HOME: ${{ runner.workspace }}/github-actions-test
    - uses: actions/upload-artifact@master
      name: Upload Artifact
      with:
        name: ffmpeg
        path: ffmpeg/install
